<!DOCTYPE html>
<html lang="en-us">
  

<head>
  <meta name="theme" content="Syna">
  <meta name="theme-version" content="v0.17.4">
  <meta name="theme-url" content="https://syna.okkur.org">
  <meta name="theme-description" content="Highly customizable open source theme for Hugo based static websites">
  <meta name="theme-author" content="Okkur Labs">
  <meta name="theme-author-url" content="https://about.okkur.org">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="google" content="notranslate" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="description" content="Week 10 - Machine Building and End Effectors Building a Useless Machine A &ldquo;useless machine&rdquo; is a project you often see at Maker Faires which generally look like a box with a switch. When a person flips this switch, a little robot arm will pop out of the box to flip it back and then return to the box.
I want to build one of these with a stepper motor, a limit switch, and a normal switch.">
  <meta property="og:title" content="Week 10 - Machine Building and End Effectors" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/portfolio/week-10/" /><meta property="article:section" content="portfolio" />
<meta property="article:published_time" content="2022-07-26T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-26T12:03:34-04:00" />


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Week 10 - Machine Building and End Effectors &amp;middot; Ion The Prize - PHYS-12" />
  <meta name="twitter:description" content="Week 10 - Machine Building and End Effectors Building a Useless Machine A &ldquo;useless machine&rdquo; is a project you often see at Maker Faires which generally look like a box with a switch. When a person flips this switch, a little robot arm will pop out of the box to flip it back and then return to the box.
I want to build one of these with a stepper motor, a limit switch, and a normal switch.">
  <meta name="twitter:url" content="/portfolio/week-10/" />
        <meta property="og:image" content="">
        <meta name="twitter:image" content="">
  <meta name="author" content="Ion The Prize">

  <meta name="generator" content="Hugo 0.101.0" />

  <title>Week 10 - Machine Building and End Effectors &middot; Ion The Prize - PHYS-12</title>

  <!-- Theme Styles -->
  <style>
.mx-0 {
  margin-left: 0 !important;
  margin-right: 0 !important; }

 
@-ms-viewport {
  width: device-width; }

html {
  box-sizing: border-box;
  -ms-overflow-style: scrollbar; }

*,
*::before,
*::after {
  box-sizing: inherit; }

.container {
  width: 100%;
  padding-right: 15px;
  padding-left: 15px;
  margin-right: auto;
  margin-left: auto;
  max-width: 540px;
  max-width: 720px;
  max-width: 960px;
  max-width: 1140px; }

.container-fluid {
  width: 100%;
  padding-right: 15px;
  padding-left: 15px;
  margin-right: auto;
  margin-left: auto; }

.row {
  display: flex;
  flex-wrap: wrap;
  margin-right: -15px;
  margin-left: -15px; }

.no-gutters {
  margin-right: 0;
  margin-left: 0; }
  .no-gutters > .col,
  .no-gutters > [class*="col-"] {
    padding-right: 0;
    padding-left: 0; }

.col-1, .col-2, .col-3, .col-4, .col-5, .col-6, .col-7, .col-8, .col-9, .col-10, .col-11, .col-12, .col,
.col-auto {
  position: relative;
  width: 100%;
  min-height: 1px;
  padding-right: 15px;
  padding-left: 15px; }

.col {
  flex-basis: 0;
  flex-grow: 1;
  max-width: 100%; }

.col-auto {
  flex: 0 0 auto;
  width: auto;
  max-width: none; }

.col-1 {
  flex: 0 0 8.33333%;
  max-width: 8.33333%; }

.col-2 {
  flex: 0 0 16.66667%;
  max-width: 16.66667%; }

.col-3 {
  flex: 0 0 25%;
  max-width: 25%; }

.col-4 {
  flex: 0 0 33.33333%;
  max-width: 33.33333%; }

.col-5 {
  flex: 0 0 41.66667%;
  max-width: 41.66667%; }

.col-6 {
  flex: 0 0 50%;
  max-width: 50%; }

.col-7 {
  flex: 0 0 58.33333%;
  max-width: 58.33333%; }

.col-8 {
  flex: 0 0 66.66667%;
  max-width: 66.66667%; }

.col-9 {
  flex: 0 0 75%;
  max-width: 75%; }

.col-10 {
  flex: 0 0 83.33333%;
  max-width: 83.33333%; }

.col-11 {
  flex: 0 0 91.66667%;
  max-width: 91.66667%; }

.col-12 {
  flex: 0 0 100%;
  max-width: 100%; }

.order-first {
  order: -1; }

.order-last {
  order: 13; }

.order-0 {
  order: 0; }

.order-1 {
  order: 1; }

.order-2 {
  order: 2; }

.order-3 {
  order: 3; }

.order-4 {
  order: 4; }

.order-5 {
  order: 5; }

.order-6 {
  order: 6; }

.order-7 {
  order: 7; }

.order-8 {
  order: 8; }

.order-9 {
  order: 9; }

.order-10 {
  order: 10; }

.order-11 {
  order: 11; }

.order-12 {
  order: 12; }

.offset-1 {
  margin-left: 8.33333%; }

.offset-2 {
  margin-left: 16.66667%; }

.offset-3 {
  margin-left: 25%; }

.offset-4 {
  margin-left: 33.33333%; }

.offset-5 {
  margin-left: 41.66667%; }

.offset-6 {
  margin-left: 50%; }

.offset-7 {
  margin-left: 58.33333%; }

.offset-8 {
  margin-left: 66.66667%; }

.offset-9 {
  margin-left: 75%; }

.offset-10 {
  margin-left: 83.33333%; }

.offset-11 {
  margin-left: 91.66667%; }

.d-none {
  display: none !important; }

.d-inline {
  display: inline !important; }

.d-inline-block {
  display: inline-block !important; }

.d-block {
  display: block !important; }

.d-table {
  display: table !important; }

.d-table-row {
  display: table-row !important; }

.d-table-cell {
  display: table-cell !important; }

.d-flex {
  display: flex !important; }

.d-inline-flex {
  display: inline-flex !important; }

@media print {
  .d-print-none {
    display: none !important; }
  .d-print-inline {
    display: inline !important; }
  .d-print-inline-block {
    display: inline-block !important; }
  .d-print-block {
    display: block !important; }
  .d-print-table {
    display: table !important; }
  .d-print-table-row {
    display: table-row !important; }
  .d-print-table-cell {
    display: table-cell !important; }
  .d-print-flex {
    display: flex !important; }
  .d-print-inline-flex {
    display: inline-flex !important; } }

.flex-row {
  flex-direction: row !important; }

.flex-column {
  flex-direction: column !important; }

.flex-row-reverse {
  flex-direction: row-reverse !important; }

.flex-column-reverse {
  flex-direction: column-reverse !important; }

.flex-wrap {
  flex-wrap: wrap !important; }

.flex-nowrap {
  flex-wrap: nowrap !important; }

.flex-wrap-reverse {
  flex-wrap: wrap-reverse !important; }

.flex-fill {
  flex: 1 1 auto !important; }

.flex-grow-0 {
  flex-grow: 0 !important; }

.flex-grow-1 {
  flex-grow: 1 !important; }

.flex-shrink-0 {
  flex-shrink: 0 !important; }

.flex-shrink-1 {
  flex-shrink: 1 !important; }

.justify-content-start {
  justify-content: flex-start !important; }

.justify-content-end {
  justify-content: flex-end !important; }

.justify-content-center {
  justify-content: center !important; }

.justify-content-between {
  justify-content: space-between !important; }

.justify-content-around {
  justify-content: space-around !important; }

.align-items-start {
  align-items: flex-start !important; }

.align-items-end {
  align-items: flex-end !important; }

.align-items-center {
  align-items: center !important; }

.align-items-baseline {
  align-items: baseline !important; }

.align-items-stretch {
  align-items: stretch !important; }

.align-content-start {
  align-content: flex-start !important; }

.align-content-end {
  align-content: flex-end !important; }

.align-content-center {
  align-content: center !important; }

.align-content-between {
  align-content: space-between !important; }

.align-content-around {
  align-content: space-around !important; }

.align-content-stretch {
  align-content: stretch !important; }

.align-self-auto {
  align-self: auto !important; }

.align-self-start {
  align-self: flex-start !important; }

.align-self-end {
  align-self: flex-end !important; }

.align-self-center {
  align-self: center !important; }

.align-self-baseline {
  align-self: baseline !important; }

.align-self-stretch {
  align-self: stretch !important; }
</style>

      <link href="/style.min.db918c0e2126f0ddced7934c076855dba53c5adc6342e12321b1e04adf78b049.css" rel="stylesheet">
      <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
      <link rel="icon" sizes="16x16 32x32" type="image/x-icon" href="/favicon.ico">
      <link rel="icon" href="/favicon.png">
      <link rel="apple-touch-icon-precomposed" href="/favicon.png">
      <link rel="icon" type="image/svg+xml" href="/favicon.svg">

  <script>
    window.syna = {
      
    };
  </script>
  <script src="/scripts/syna-head.min.947341ad24dd3253dfbe2ce8aeedfa838860075c3fe729f15b49c09e42c71a64.js"></script></head>
<body class="bg-secondary">
    <!-- Navigation --><nav class="overlay fragment navbar navbar-expand-lg py-2 scroll-spy bg-light navbar-light" id="nav" role="navigation">
  <div class="container">
      <a class="navbar-brand py-0" href="/#">
        <img src="/images/logo.svg" height="35" class="d-inline-block align-top" alt="PHYS-12">
      </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-collapse justify-content-end collapse show" id="navbarCollapse">
      <ul class="navbar-nav"><li class="nav-item ">
              <a
                  class="nav-link"
                
                  href="/"
                >
                Home
              </a>
              
            </li><li class="nav-item ">
              <a
                  class="nav-link"
                
                  href="/about"
                >
                About
              </a>
              
            </li><li class="nav-item ">
              <a
                  class="nav-link anchor"
                
                  href="/#contact"
                >
                Contact
              </a>
              
            </li>
      </ul>
    </div>
  </div>
    <div class="d-none d-lg-block pl-auto">
      <a class="btn btn-light ignore-color-change" href="https://github.com/okkur/syna" role="button" title="Github">
        <i class="fab fa-github mr-2"></i>
        GitHub
      </a>
    </div>
</nav>

<div class="scroll-to-top bg-primary has-font-icon"
  title="Back to top"
  ><i class="fas fa-angle-up"></i><span class="sr-only">Back to top</span>
</div>
<!-- Content -->
<section id="content" class="fragment content-fragment">
    <div class="container-fluid bg-light overlay">
    <div class="container py-5 overlay">
<div class="row">
      <article class="col-md-12">
<div class="content-body col-12 content px-0 text-body"><h1 id="week-10---machine-building-and-end-effectors">Week 10 - Machine Building and End Effectors</h1>
<h2 id="building-a-useless-machine">Building a Useless Machine</h2>
<p>A &ldquo;useless machine&rdquo; is a project you often see at Maker Faires which generally look like a box with a switch. When a person flips this switch, a little robot arm will pop out of the box to flip it back and then return to the box.</p>
<p>I want to build one of these with a stepper motor, a limit switch, and a normal switch. When the normal switch is flipped, the motor will turn until it is flipped back. The motor will then have its zero position updated and rotate in the opposite direction until it hits the limit switch, at which point its zero is re-updated (and it will rotate a couple steps until the limit switch is un-pressed).</p>
<p>To start, I had to solder headers onto my <a href="https://www.pololu.com/product/2876">STSPIN220 microstepping bipolar stepper motor driver</a>. I also soldered female dupont connections to my <a href="https://www.adafruit.com/product/324">stepper motor</a>&rsquo;s wires so I can connect it to a breadboard.</p>
<p align="center">
<img src="" alt="" width=/>
</p>
<p align="center">
<img src="" alt="" width=/>
</p>
<p align="center">
<img src="" alt="" width=/>
</p>
<p>I wired the driver according to the <a href="https://a.pololu-files.com/picture/0J9750.1200.jpg?018aeb688feed9c63fc87c5f22f17805">minimal wiring diagram</a> on pololu&rsquo;s website and then set the current limit to be 1 A by adjusting the VREF voltage screw to 0.2 V. I then wired the motor according to the minimal wiring diagram. The stepper motor&rsquo;s pins are the phases; pins 1 (orange wire) and 3 (blue) make up phase B and pins 4 (red) and 6 (yellow) make up phase A. The motor power supply is a benchtop power supply. <code>MODE1</code> and <code>MODE2</code> pins are hard-wired to LOW for now.</p>
<p align="center">
<img src="" alt="" width=/>
</p>
<p align="center">
<img src="" alt="" width=/>
</p>
<p>I wrote some test code just to rotate the stepper. The I tested a few various delays and a delay of 2 milliseconds seemed to work best. When the dirPin is LOW, the motor rotates anticlockwise, and clockwise when it is HIGH.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// set pin connections
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> stepPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> dirPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  pinMode(stepPin, OUTPUT);
</span></span><span style="display:flex;"><span>  pinMode(dirPin, OUTPUT);
</span></span><span style="display:flex;"><span>  Serial.begin(<span style="color:#ae81ff">9600</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>  digitalWrite(dirPin, HIGH);
</span></span><span style="display:flex;"><span>  digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>  delay(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>  digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>  delay(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I wanted to experiment with microsteps, so I wired up the standby pin and changed <code>MODE1</code> to HIGH and added a bit of code in <code>setup</code> to tell the stepper to use half steps:</p>
<p align="center">
<img src="" alt="" width=/>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#75715e">// latch half step setting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(stbyPin, LOW);  <span style="color:#75715e">// enter standby mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>  digitalWrite(dirPin, LOW);
</span></span><span style="display:flex;"><span>  digitalWrite(stbyPin, HIGH);  <span style="color:#75715e">// exit standby mode
</span></span></span></code></pre></div><p>The motion is jerky and current draw is up eightfold (from 25 mA to 200mA). I tested a couple different values and lowering the delay from 2 milliseconds to 0.25 milliseconds works better; current draw is now at the same 25-ish mA, motion is slower than with full steps but also smoother, torque is higher, and the motor only draws ~10 mA more when forcefully halted (as opposed to 75 mA more when using full steps).</p>
<p>I cleaned up a two-state, three-pronged switch I had and soldered some headers to it after some short, breadboard-compatible wires proved a bit too flimsy for my liking.</p>
<p align="center">
<img src="" alt="The switch as I had it." width=/>
</p>
<p align="center">
<img src="" alt="The switch with breadboard-compatible wires." width=/>
</p>
<p align="center">
<img src="" alt="The switch with headers." width=/>
</p>
<p>I&rsquo;ll be using the switch as a pullup input instead of a &ldquo;normal&rdquo; input even though it has three prongs because I&rsquo;m not sure if I want to use this specific switch in a finished product, and more switches have two prongs than not (though this choice does mean that the third prong basically becomes a decoration).</p>
<p>I added a button to work as a limit switch, set it to also be a pullup input, and wrote some homing code utilizing it in <code>setup</code> after adding a mutable <code>steps</code> variable:</p>
<p align="center">
<img src="" alt="The button and switch wired up." width=/>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  <span style="color:#75715e">// home motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  limitState <span style="color:#f92672">=</span> digitalRead(limitPin);  <span style="color:#75715e">// read limit switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(dirPin, LOW);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">while</span> (limitState <span style="color:#f92672">==</span> HIGH) {
</span></span><span style="display:flex;"><span>    limitState <span style="color:#f92672">=</span> digitalRead(limitPin);  <span style="color:#75715e">// read limit switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// step motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">1.5</span>);
</span></span><span style="display:flex;"><span>    digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">1.5</span>);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>I changed the way the motor steps as well. Because the motor should always be able to move away from the limit switch if the toggle has been flipped, even if it is at home, this has a special if statement. For the motor to be able to turn towards the home position, first the limit switch can&rsquo;t be pressed and then the toggle has to be in the correct state. With this, the loop function looks as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>  limitState <span style="color:#f92672">=</span> digitalRead(limitPin);  <span style="color:#75715e">// read limit switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  switchState <span style="color:#f92672">=</span> digitalRead(toggleSwitchPin);  <span style="color:#75715e">// read toggle switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (switchState <span style="color:#f92672">==</span> HIGH) {
</span></span><span style="display:flex;"><span>    digitalWrite(dirPin, HIGH);  <span style="color:#75715e">// clockwise and away from limit switch (towards toggle switch)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// step motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.5</span>;  <span style="color:#75715e">// using half step microsteps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (limitState <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (switchState <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    digitalWrite(dirPin, LOW);  <span style="color:#75715e">// anticlockwise and towards limit switch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// step motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">-=</span> <span style="color:#ae81ff">0.5</span>;  <span style="color:#75715e">// using half step microsteps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  Serial.println(steps);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Lastly, after playing around with different microstep fractions and wait times, using 1/8 steps with 1.5 ms delays for initial homing and half steps with 0.075 ms delays for everything else seems to strike a promising balance between torque, speed, and current draw (and this combination also enables <code>MODE1</code> and <code>MODE2</code> to be hard-wired).</p>
<p>With this, the code should be done!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// set pin connections
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> stepPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> dirPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;  <span style="color:#75715e">// direction
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> stbyPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;  <span style="color:#75715e">// standby
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> limitPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;  <span style="color:#75715e">// limit switch (button) pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> toggleSwitchPin <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>;  <span style="color:#75715e">// toggle switch pin
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> limitState <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#75715e">// pushbutton value variable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">float</span> steps <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#75715e">// current stepper motor position
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> switchState <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;  <span style="color:#75715e">// switch value variable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setup</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// initialize stepper pins
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  pinMode(stepPin, OUTPUT);
</span></span><span style="display:flex;"><span>  pinMode(dirPin, OUTPUT);
</span></span><span style="display:flex;"><span>  pinMode(stbyPin, OUTPUT);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// initialize input pins
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  pinMode(limitPin, INPUT_PULLUP);
</span></span><span style="display:flex;"><span>  pinMode(toggleSwitchPin, INPUT_PULLUP);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// latch 1/8 step setting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(stbyPin, LOW);  <span style="color:#75715e">// enter standby mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>  digitalWrite(dirPin, HIGH);
</span></span><span style="display:flex;"><span>  digitalWrite(stbyPin, HIGH);  <span style="color:#75715e">// exit standby mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// home motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  limitState <span style="color:#f92672">=</span> digitalRead(limitPin);  <span style="color:#75715e">// read limit switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(dirPin, LOW);  <span style="color:#75715e">// rotate anticlockwise
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">while</span> (limitState <span style="color:#f92672">==</span> HIGH) {
</span></span><span style="display:flex;"><span>    limitState <span style="color:#f92672">=</span> digitalRead(limitPin);  <span style="color:#75715e">// read limit switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// step motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">1.5</span>);
</span></span><span style="display:flex;"><span>    digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">1.5</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  steps <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// latch half step setting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(stbyPin, LOW);  <span style="color:#75715e">// enter standby mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>  digitalWrite(dirPin, LOW);
</span></span><span style="display:flex;"><span>  digitalWrite(stbyPin, HIGH);  <span style="color:#75715e">// exit standby mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  
</span></span><span style="display:flex;"><span>  Serial.begin(<span style="color:#ae81ff">9600</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">loop</span>() {
</span></span><span style="display:flex;"><span>  limitState <span style="color:#f92672">=</span> digitalRead(limitPin);  <span style="color:#75715e">// read limit switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  switchState <span style="color:#f92672">=</span> digitalRead(toggleSwitchPin);  <span style="color:#75715e">// read toggle switch state
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (switchState <span style="color:#f92672">==</span> HIGH) {
</span></span><span style="display:flex;"><span>    digitalWrite(dirPin, HIGH);  <span style="color:#75715e">// clockwise and away from limit switch (towards toggle switch)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// step motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.5</span>;  <span style="color:#75715e">// using half step microsteps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (limitState <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (switchState <span style="color:#f92672">==</span> LOW) {
</span></span><span style="display:flex;"><span>    digitalWrite(dirPin, LOW);  <span style="color:#75715e">// anticlockwise and towards limit switch
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// step motor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    digitalWrite(stepPin, HIGH);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    digitalWrite(stepPin, LOW);
</span></span><span style="display:flex;"><span>    delay(<span style="color:#ae81ff">0.075</span>);
</span></span><span style="display:flex;"><span>    steps <span style="color:#f92672">-=</span> <span style="color:#ae81ff">0.5</span>;  <span style="color:#75715e">// using half step microsteps
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  Serial.println(steps);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></div>
    </article>
  </div>
    </div>
    </div>
</section>

<!-- Footer -->
<section id="footer" class="fragment ">
    <div class="container-fluid bg-light ">
    <div class="container py-5 ">

  <div class="row">
    <div class="col-md m-2 text-body">
        <h4></h4>
        <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
          <img src="/images/logo.svg" class="img-fluid w-50" alt="Click the logo on the header to go to the homepage. Click this one to get rickrolled.">
        </a>
        <div class="row justify-content-left ml-0">
            <span class="fa-stack fa-2x mt-3 mr-1" title="facebook">
              <a href="/#" class="ignore-color-change">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-facebook-f fa-stack-1x fa-fw text-light"></i>
                <span class="sr-only">facebook</span>
              </a>
            </span>
            <span class="fa-stack fa-2x mt-3 mr-1" title="linkedin">
              <a href="/#" class="ignore-color-change">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin-in fa-stack-1x fa-fw text-light"></i>
                <span class="sr-only">linkedin</span>
              </a>
            </span>
        </div>
    </div>
    <div class="col-md m-2 text-body">
        <h4>Link Title</h4>
        <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link p-0 display-5" href="/#"
                    class="anchor">Link</a>
              </li>
              <li class="nav-item">
                <a class="nav-link p-0 display-5" href="/#"
                    class="anchor">Long Link</a>
              </li>
              <li class="nav-item">
                <a class="nav-link p-0 display-5" href="/#"
                    class="anchor">Tiny Link</a>
              </li>
        </ul>
    </div>
    <div class="col-md m-2 text-body">
        <div><h4 id="description-title">Description Title</h4>
<p>Project description such as:
Open source theme for your next project
Provided by Okkur Labs</p>
</div>
    </div>
  </div>
    </div>
    </div>
</section>


<!-- Copyright -->
<footer class="overlay fragment container-fluid bg-light" id="copyright">
  <div class="container">
    <div class="row py-3">
      <div class="col-md">
        <div class="row mx-0 my-2 justify-content-center text-center text-lg-none text-black-50">
          <div class="row mx-0 mr-lg-auto justify-content-center">
              <div class="col-auto px-1 copyright-legal">© Copyright&nbsp;2022</div>
              <div class="col-auto px-0 copyright-by"> by  Ion The Prize</div>
          </div>
        </div>
      </div>
        <div class="col-auto mx-auto">
          <div class="row mx-0 navbar-text text-center text-black-50">Website based on<a href="https://syna.okkur.org" class="ml-1">Syna</a>
          </div>
        </div>
        <div class="col-md">
          <div class="row mx-0 my-2 justify-content-center">
            <ul class="nav ml-lg-auto">
                <li class="nav-item">
                  <a class="nav-link py-0" href="/about"
                  >About Me</a>
                </li>
            </ul>
          </div>
        </div>
    </div>
  </div>
</footer>
<div id="react"></div>

    <!-- Theme Code -->
      <script async defer src="/scripts/syna-main.min.1a3a81d584c3d2f114f3575196cd38adec80434bd26ffac023d494745d306358.js"></script>
      <script async defer src="/scripts/syna-content.min.b0072d521bf38e98e2da1d20333cc046a07539294375bff38d5372885de52181.js"></script>
  </body>
</html>
